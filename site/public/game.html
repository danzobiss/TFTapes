<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/1/1.0.6/iconify.min.js"></script>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="icon" href="./img/logo.svg">
    <title>TFTapes</title>
</head>

<body onload="logado(), renderizarPontos()">
    <div class="header">
        <div class="container">
            <img src="./img/logo.svg" alt="Logo do TFTapes" class="logo">
            <h1>TFTapes</h1>
            <ul class="navbar">
                <li><a href="./index.html">HOME</a></li>
                <li><a href="./historia.html">HISTÓRIA</a></li>
                <li id="liGame"><a href="./game.html"><span class="destaque">GAME</span></a></li>
                <li><a href="./dicas.html">DICAS</a></li>
                <li id="liEnquetes" class="dropdown">
                    <p class="dropBtn">ENQUETES</p>
                    <div class="dropdownConteudo">
                        <a href="./arenas.html">ARENAS</a>
                        <a href="./lendas.html">PEQUENAS LENDAS</a>
                    </div>
                </li>
                <div class="separador"></div>
                <li id="liLogin"><a id="lblLoginNavbar"><span>LOGIN</span><div style="height: 22px; width: 22px; float: right; margin-left: 6px;">
                    <span class="iconify" data-inline="false" data-icon="simple-line-icons:login" style="color: #ffffff; font-size: 24px;"></span>
                </div></a></li>
                <li id="liUsuario" style="display: none;"><a id="lblUsuarioNavbar">USER</a></li>
            </ul>
        </div>
    </div>

    <div class="game">
        <div class="container">
            <h1 class="titulo">Choncc's Hungry</h1>
            <p>O objetivo do jogo é alimentar Choncc o máximo que conseguir antes que o tempo acabe.<br><br>Clique nos botões ou use as teclas 1, 2 e 3 para oferecer morangos, cenoura ou carne e assim aumentar sua pontuação. Cada alimento enche a barriga
                do Choncc em valores diferentes (morangos: 2pts, cenoura: 15pts, carne: 50pts), mas alguns deles possuem <i>cooldown</i> para serem utilizados novamente.<br><br>Pronto para encher a barriga?</p>
            <div class="jogo">
                <div style="display: flex; justify-content: space-between;">
                    <b>Maior Pontuação: <span id="lblMaxPontos">0</span></b>
                    <b id="lblTimer">Timer</b>
                </div>
                <div class="meio">
                    <button id="btnJogar">Jogar</button>
                    <b id="lblPontos" style="color: #b1925d; display: none;">Pontuação:<br>0</b>
                </div>
                <div class="horizontal">
                    <div class="cardAlimento">
                        <img src="./img/morangos.png" alt="Imagem de Morangos"><br>
                        <b>Morangos</b><br>
                        <button id="btnMorangos" class="btnAlimento btnDesativado" onclick="morangos()" disabled>Oferecer</button>
                    </div>
                    <div class="cardAlimento">
                        <img src="./img/cenoura.png" alt="Imagem de Cenoura"><br>
                        <b>Cenoura</b><br>
                        <button id="btnCenoura" class="btnAlimento btnDesativado" onclick="cenoura()" disabled>Oferecer</button>
                    </div>
                    <div class="cardAlimento">
                        <img src="./img/carne.png" alt="Imagem de Carne"><br>
                        <b>Carne</b><br>
                        <button id="btnCarne" class="btnAlimento btnDesativado" onclick="carne()" disabled>Oferecer</button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <div class="footer">
        <div class="container">
            <div class="horizontal">
                <a href="https://www.facebook.com/henrique.danzobaria" class="icones"><span class="iconify" data-inline="false" data-icon="akar-icons:facebook-fill" style="color: #b1925d; font-size: 24px;"></span></a>
                <a href="https://www.instagram.com/danzobiss/" class="icones"><span class="iconify" data-inline="false" data-icon="akar-icons:instagram-fill" style="color: #b1925d; font-size: 24px;"></span></a>
                <a href="https://twitter.com/danzobiss" class="icones"><span class="iconify" data-inline="false" data-icon="akar-icons:twitter-fill" style="color: #b1925d; font-size: 24px;"></span></a>
            </div>
            <p><a href="https://tftapes.freshdesk.com/a/tickets/new">Suporte</a> · <a href="./sobre.html">Sobre</a></p>
            <p style="color: #8E8E8E;">&copy; 2021 TFTapes</p>
        </div>
    </div>

    <div id="modalLogin" class="modal">
        <div class="conteudoModal">
            <span class="fechar" id="fecharLogin">&cross;</span>
            <form id="formLogin" method="POST" onsubmit="return entrar()">
                <h1 class="tituloModal titulo">Login</h1>
                <div class="label-float">
                    <input type="text" placeholder=" " id="txtLogin" name="loginHTML" />
                    <label>Nome de Usuário</label>
                </div>
                <div class="label-float">
                    <input type="password" placeholder=" " id="txtSenhaLogin" name="senhaLoginHTML" />
                    <label>Senha</label>
                </div>
                <a href="./recuperarSenha.html"><b>Esqueceu a Senha?</b></a><br>
            </form>
            <button id="btnLoginOnLogin" class="btnModal" onclick="entrar()">Entrar</button><br>
            <button id="btnCadastroOnLogin" class="btnModal btnModalBranco">Não tem uma conta? Cadastre-se!</button>
        </div>
    </div>
    <div id="modalCadastro" class="modal">
        <div class="conteudoModal">
            <span class="fechar" id="fecharCadastro">&cross;</span>
            <form id="formCadastro" method="POST" onsubmit="return cadastrar()">
                <h1 class="tituloModal titulo">Cadastro</h1>
                <div class="label-float">
                    <input type="text" placeholder=" " id="txtUsuario" name="cadastroHTML" />
                    <label>Nome de Usuário</label>
                </div>
                <div class="label-float">
                    <input type="password" placeholder=" " id="txtSenhaCadastro" name="senhaCadastroHTML" required minlength="8" maxlength="20" />
                    <label>Senha</label>
                </div>
                <div class="label-float">
                    <input type="password" placeholder=" " id="txtConfirmarSenha" name="confirmSenhaHTML" minlength="8" maxlength="20" required/>
                    <label>Confirmar Senha</label>
                </div>
            </form>
            <button id="btnCadastroOnCadastro" class="btnModal" onclick="cadastrar()">Cadastrar</button><br>
            <button id="btnLoginOnCadastro" class="btnModal btnModalBranco">Já tem uma conta? Faça seu login!</button>
        </div>
    </div>
    <div id="modalUsuario" class="modal">
        <div class="conteudoModal">
            <span class="fechar" id="fecharUsuario">&cross;</span>
            <h1 class="tituloModal titulo" id="lblNomeUsuario">User</h1>
            <button id="btnSair" class="btnModal" onclick="sair()">Sair</button>
        </div>
    </div>
</body>

</html>

<script>
    let liGame = document.getElementById("liGame");
    let liEnquetes = document.getElementById("liEnquetes");
    let liLogin = document.getElementById("liLogin");
    let liUsuario = document.getElementById("liUsuario");

    let lblLoginNavbar = document.getElementById("lblLoginNavbar");
    let lblUsuarioNavbar = document.getElementById("lblUsuarioNavbar");

    let modalLogin = document.getElementById("modalLogin");
    let spanLogin = document.getElementById("fecharLogin");
    let btnCadastroOnLogin = document.getElementById("btnCadastroOnLogin");

    let modalCadastro = document.getElementById("modalCadastro");
    let spanCadastro = document.getElementById("fecharCadastro");
    let btnLoginOnCadastro = document.getElementById("btnLoginOnCadastro");

    let modalUsuario = document.getElementById("modalUsuario");
    let spanUsuario = document.getElementById("fecharUsuario");
    let lblNomeUsuario = document.getElementById("lblNomeUsuario");
    let btnSair = document.getElementById("btnSair");

    lblLoginNavbar.onclick = () => modalLogin.style.display = "block";
    lblUsuarioNavbar.onclick = () => modalUsuario.style.display = "block";

    spanLogin.onclick = () => modalLogin.style.display = "none";
    btnCadastroOnLogin.onclick = () => {
        modalLogin.style.display = "none";
        modalCadastro.style.display = "block";
    }

    spanCadastro.onclick = () => modalCadastro.style.display = "none";
    btnLoginOnCadastro.onclick = () => {
        modalCadastro.style.display = "none";
        modalLogin.style.display = "block";
    }

    spanUsuario.onclick = () => modalUsuario.style.display = "none";

    window.onclick = function(event) {
        if (event.target == modalLogin) {
            modalLogin.style.display = "none";
        }
        if (event.target == modalCadastro) {
            modalCadastro.style.display = "none";
        }
        if (event.target == modalUsuario) {
            modalUsuario.style.display = "none";
        }
    }


    function sair() {
        sessionStorage.removeItem("sessaoNomeUsuario");
        sessionStorage.removeItem("sessaoIdUsuario");
        window.location.href = './index.html';
    }

    function logado() {
        if (sessionStorage.getItem("sessaoNomeUsuario") != null) {
            liGame.style.display = "block";
            liEnquetes.style.display = "block";

            liLogin.style.display = "none";
            liUsuario.style.display = "block";

            lblUsuarioNavbar.innerHTML = sessionStorage.getItem("sessaoNomeUsuario");
            lblNomeUsuario.innerHTML = sessionStorage.getItem("sessaoNomeUsuario");
        } else {
            liGame.style.display = "none";
            liEnquetes.style.display = "none";

            liLogin.style.display = "block";
            liUsuario.style.display = "none";

            alert("Desculpa, essa página só é acessível por usuários logados. Retorne para a Home!");
            window.location.href = './index.html';
        }
    }


    //Timer
    var maxPontos = 0;

    function startTimer(duracao, elemento) {
        var timer = duracao,
            minutos, segundos;
        var intervalo = setInterval(function() {
            minutos = parseInt(timer / 60, 10);
            segundos = parseInt(timer % 60, 10);

            minutos = minutos < 10 ? "0" + minutos : minutos;
            segundos = segundos < 10 ? "0" + segundos : segundos;

            elemento.textContent = minutos + ":" + segundos;

            if (--timer < 0) {
                clearInterval(intervalo);
                botoesAlimentos[0].disabled = true;
                botoesAlimentos[0].classList.add("btnDesativado");
                botoesAlimentos[1].disabled = true;
                botoesAlimentos[1].classList.add("btnDesativado");
                botoesAlimentos[2].disabled = true;
                botoesAlimentos[2].classList.add("btnDesativado");

                setTimeout(() => {
                    botoesAlimentos[1].disabled = true;
                    botoesAlimentos[1].classList.add("btnDesativado");
                    botoesAlimentos[2].disabled = true;
                    botoesAlimentos[2].classList.add("btnDesativado");
                }, 5000)

                if (Number(lblMaxPontos.textContent) < pontos) {
                    maxPontos = pontos
                    enviarPontos();
                }
                document.getElementById("lblMaxPontos").innerHTML = maxPontos;

            }
        }, 1000);
    }

    var botoesAlimentos = document.getElementsByClassName("btnAlimento");
    let btnMorangos = document.getElementById("btnMorangos");
    let btnCenoura = document.getElementById("btnCenoura");
    let btnCarne = document.getElementById("btnCarne");

    btnJogar.onclick = function() {
        document.getElementById("btnJogar").style.display = "none";
        document.getElementById("lblPontos").style.display = "flex";
        document.getElementById("lblTimer").textContent = "01:00"


        botoesAlimentos[0].disabled = false;
        botoesAlimentos[0].classList.remove("btnDesativado");
        botoesAlimentos[1].disabled = false;
        botoesAlimentos[1].classList.remove("btnDesativado");
        botoesAlimentos[2].disabled = false;
        botoesAlimentos[2].classList.remove("btnDesativado");

        var umMinuto = 59;
        startTimer(umMinuto, document.getElementById("lblTimer"));
        document.body.onkeydown = () => {
            switch (event.keyCode) {
                case 49:
                    btnMorangos.click();
                    break;
                case 50:
                    btnCenoura.click();
                    break;
                case 51:
                    btnCarne.click();
                    break;
                default:
                    break;
            }
        };
    };

    var pontos = 0;

    function atualizarPontos() {
        lblPontos.innerHTML = `Pontuação:<br>${pontos}`;
    }

    function morangos() {
        pontos += 2;
        atualizarPontos();
    }

    function cenoura() {
        pontos += 15;
        atualizarPontos();
        botoesAlimentos[1].disabled = true;
        botoesAlimentos[1].classList.add("btnDesativado");
        setTimeout(() => {
            botoesAlimentos[1].disabled = false
            botoesAlimentos[1].classList.remove("btnDesativado");
        }, 2000);
    }

    function carne() {
        pontos += 50;
        atualizarPontos();
        botoesAlimentos[2].disabled = true;
        botoesAlimentos[2].classList.add("btnDesativado");
        setTimeout(() => {
            botoesAlimentos[2].disabled = false
            botoesAlimentos[2].classList.remove("btnDesativado");
        }, 5000);
    }


    function enviarPontos() {
        fetch(`/usuarios/atualizarPontuacao/idUsuario/${sessionStorage.getItem("sessaoIdUsuario")}/maiorPont/${maxPontos}`, {
            method: "POST"
        }).then(function(resposta) {

            if (resposta.ok) {


            } else {


            }
        });

        return false;
    }

    function renderizarPontos() {
        fetch(`/usuarios/renderizarPontuacao/idUsuario/${sessionStorage.getItem("sessaoIdUsuario")}`, {
            method: "POST"
        }).then(function(resposta) {

            if (resposta.ok) {
                resposta.json().then(json => {
                    maxPontos = json[0].maiorPont;
                    document.getElementById("lblMaxPontos").innerHTML = maxPontos;

                });

            } else {


            }
        });

        return false;
    }
</script>